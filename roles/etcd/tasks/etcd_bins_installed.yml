- name: etcd bins
  vars:
    _etcd_archive_basename: etcd-v{{ etcd__etcd_version }}-linux-amd64
    _etcd_archive: '{{ _etcd_archive_basename }}.tar.gz'
  block:
  - name: etcd archive is downloaded
    get_url:
      url: '{{ etcd__etcd_archive_download_url_base }}/v{{ etcd__etcd_version }}/{{ _etcd_archive }}'
      dest: /tmp/{{ _etcd_archive }}
      checksum: '{{ etcd__etcd_archive_checksum }}'
    register: _get_url_result
  - name: etcd archive is extracted
    unarchive:
      src: /tmp/{{ _etcd_archive }}
      remote_src: True
      dest : /tmp
    when: _get_url_result.changed
  - name: etcd bins are installed
    copy:
      remote_src: True
      src: /tmp/{{ _etcd_archive_basename }}/{{ item }}
      dest: /usr/bin/
      owner: root
      group: root
      mode: 0755
    loop:
    - etcd
    - etcdctl
