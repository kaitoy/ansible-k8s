- name: k8s components are ready
  command: kubectl get componentstatuses
  register: _componentstatuses
  until: _componentstatuses.stdout.find('Unhealthy') == -1
  retries: 5
  delay: 5
  changed_when: False

- name: ClusterRoleBinding 'kube-proxy:node-proxier' exists
  command: kubectl apply -f -
  args:
    stdin : |
      apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRoleBinding
      metadata:
        name: kube-proxy:node-proxier
      roleRef:
        apiGroup: rbac.authorization.k8s.io
        kind: ClusterRole
        name: system:node-proxier
      subjects:
      - kind: ServiceAccount
        name: kube-proxy
        namespace: system
  register: _apply_result
  changed_when: '" created" in _apply_result.stdout or " configured" in _apply_result.stdout'
